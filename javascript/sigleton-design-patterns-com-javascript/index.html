<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
    <meta name="description" content="Singleton diz que você terá apenas uma instância de classe.">
  

  <meta content="Saulo Santiago" property="og:site_name">

  
    <meta content="Singleton Design Patterns com Javascript" property="og:title">
  

  
    <meta content="article" property="og:type">
  

  
    <meta content="https://saulosilva.github.io/javascript/sigleton-design-patterns-com-javascript" property="og:url">
  

  
    <meta content="2015-05-17T00:00:00+00:00" property="article:published_time">

    <meta content="https://saulosilva.github.io/about/" property="article:author">
  

  
    <meta content="/assets/posts/javascript/sigleton-design-patterns-com-javascript-big-70391f44a3116ee097bea5c3d95c3b7b.png" property="og:image">
  

  
    
      <meta content="javascript" property="article:section">
    
  

  
    
      <meta content="JS" property="article:tag">
    
      <meta content="Javascript" property="article:tag">
    
      <meta content="Singleton" property="article:tag">
    
      <meta content="Design Pattern" property="article:tag">
    
      <meta content="ES5" property="article:tag">
    
      <meta content="ES6" property="article:tag">
    
  

  <title>
    
      Singleton Design Patterns com Javascript &middot; Saulo Santiago
    
  </title>

  
    
      <link rel="alternate" type="application/rss+xml" title="" href="https://saulosilva.github.io/feed.post.xml">
    
  

  <link rel="apple-touch-icon" sizes="57x57" href="/public/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/public/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/public/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/public/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/public/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/public/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-icon-180x180.png">

  <link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/public/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/public/android-icon-192x192.png">

  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/public/ms-icon-144x144.png">
  <meta name="theme-color" content="#005461">
  <meta name="application-name" content="Saulo Silva">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#005461">
  <meta name="apple-mobile-web-app-title" content="Saulo Silva">

  <link rel="manifest" href="/public/manifest.json">

  <meta name="google-site-verification" content="qTDNZDltvhWwROeyTBrdXmY5_3yOcvN8XoqUgpn3bmM" />

  <link rel="stylesheet" href="/assets/application-471532374005af79eebd8a3784137994.css">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63356631-1', 'auto');
  ga('send', 'pageview');
</script>
</head>

  <body>
    <nav>
  <div class="nav-wrapper">
    <a href="/" title="Home" class="brand-logo truncate">
      <img src="/assets/logo-bg-50x50-8e3f04ec10ab8e502401cd06a7356b2e.png" class='circle'>
      Saulo Santiago
    </a>

    <a href="#" data-activates="mobile-demo" class="button-collapse">
      <i class="mdi-navigation-menu"></i>
    </a>

    <ul id="nav-mobile" class="right hide-on-med-and-down">
      
        <li>
          <a href="http://saulosantiago.com.br">
            About
          </a>
        </li>
      
        <li>
          <a href="/ruby">
            Ruby
          </a>
        </li>
      
        <li>
          <a href="/javascript">
            Javascript
          </a>
        </li>
      
        <li>
          <a href="/feed.xml">
            Feed
          </a>
        </li>
      
    </ul>

    <ul class="side-nav" id="mobile-demo">
      
        <li>
          <a href="http://saulosantiago.com.br">
            About
          </a>
        </li>
      
        <li>
          <a href="/ruby">
            Ruby
          </a>
        </li>
      
        <li>
          <a href="/javascript">
            Javascript
          </a>
        </li>
      
        <li>
          <a href="/feed.xml">
            Feed
          </a>
        </li>
      
    </ul>
  </div>
</nav>

    <main>
      <div class='post-show z-depth-1'>
  <article class="markdown-body">
    <h1>Singleton Design Patterns com Javascript</h1>
    <span class='read-time'>
      <i class='mdi-device-access-time'></i>
      Leia em: 6 minutos
    </span>

    <span class='author-info'>
      <img src="//www.gravatar.com/avatar/427733403ad646d7a164918b9da1d227?s=135" alt="Foto de Saulo Santiago" width='50' height='50' class='circle responsive-img'/>
      Escrito por: <b>Saulo Santiago</b>
    </span>

    <div class='image-big'>
      <img src="/assets/posts/javascript/sigleton-design-patterns-com-javascript-big-70391f44a3116ee097bea5c3d95c3b7b.png">
    </div>

    <p><em>Singleton</em> é um <em>Design Patterns</em>. </p>

<p>Este padrão fica responsável por criar um objeto e garantir uma única instância de sua classe ou função construtora. </p>

<p>Para implementação de um objeto <em>Singleton</em>, precisamos pensar em uma forma de disponibilizarmos uma propriedade no objeto, de maneira que possamos acessá-lo direto sem a necessidade de uma instância.</p>

<h4>Implementação no ECMAScript 5</h4>

<p>Vou mostrar uma implementação básica em javascript na versão do ECMAScript 5:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">Foo</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">_instance</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span>

  <span class="nx">Foo</span><span class="p">.</span><span class="nx">getInstance</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="nx">_instance</span> <span class="o">?</span> <span class="nx">_instance</span> <span class="o">:</span> <span class="nx">_instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;new instance&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">Foo</span><span class="p">;</span>
<span class="p">})();</span>

<span class="nx">Foo</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">()</span> <span class="c1">// =&gt; new instance</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">()</span> <span class="c1">// =&gt; return object instantied</span>
</code></pre></div>
<p>De início declarei uma variável interna chamada de <code>_instance</code>. A função desta variável é guardar o estado atual da instância.</p>

<p>Logo após foi definido uma propriedade chamada de <code>getInstance</code> dentro do objeto <code>Foo</code>, essa função implementa nossa regra de <em>Singleton</em>.</p>

<p>A primeira e única instrução que encontramos dentro da nossa propriedade <code>getInstance</code> é um ternário que verifica o estado da variável <code>_instance</code>. </p>

<p>Quando a variável for nula, significa que estamos passando ali pela primeira vez, então o seguinte trecho de código é executado: <code>_instance = new Foo()</code>. </p>

<p>Das próximas <strong>n vezes</strong> já teremos a instância do objeto armazenada na variável <code>_instance</code> então apenas o retorno é feito.</p>

<h4>Implementação no ECMAScript 6</h4>

<p>Para finalizar irei mostrar um exemplo de <em>Singleton</em> utilizando o ECMAScript 6:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">_instance</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">_singletonEnforcer</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">();</span>

<span class="kr">class</span> <span class="nx">Foo</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">enforce</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;new instance&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">enforce</span> <span class="o">!==</span> <span class="nx">_singletonEnforcer</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;Cannot constructor singleton&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">getInstance</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">[</span><span class="nx">_instance</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">_instance</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="nx">_singletonEnforcer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">_instance</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Foo</span><span class="p">.</span><span class="nx">getInstance</span> <span class="c1">// =&gt; new instance</span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">getInstance</span> <span class="c1">// =&gt; return object instantied</span>
</code></pre></div>
<p>Esta lógica é quase parecida com a anterior.</p>

<p>Neste caso criei duas variável fora do escopo da classe, com o nome de <code>_instance</code> e uma outra chamada de <code>_singletonEnforcer</code> ambas definidas como símbolo. </p>

<p>Ao criar a classe <code>Foo</code> defini um método estático chamado <code>getInstance</code> que será acessado através da class <code>Foo</code> sem necessidade de instância.</p>

<p>Quando o método <code>getInstance</code> é chamado pela primeira vez, ele verifica se existe uma propriedade definida que não esteja nula <code>!this[_instance]</code>. Caso a propriedade ainda não esteja definida ele criar e atribui a instância como valor: <code>this[_instance] = new Foo(_singletonEnforcer);</code>, caso haja a propriedade ele apenas retorna <code>return this[_instance]</code>.</p>

<p>Para finalizar, na função construtora da classe eu envio <code>_singletonEnforcer</code> como uma forma de garantir que a nova instância esteja sendo chamada sempre de dentro da função <code>getInstance</code>, caso o valor seja diferente uma excessão é lançada <code>throw(&#39;Cannot constructor singleton&#39;)</code>, impedindo que a classe seja inicializada. </p>

<h4>Finalizando</h4>

<p>Imagine um objeto que tem a função de abrir uma conexão com o banco de dados antes de executar qualquer operação.</p>

<p>Se a cada operação abrirmos uma conexão, com certeza perderemos muito a qualidade de processamento, podendo até travar as conexões.</p>

<p>Mas se utilizarmos uma classe <em>Singleton</em> para fazer as conexões, evitaremos essa sobrecarga pois estaremos utilizando da mesma instância para todas as operações.</p>

<p>O conceito de <em>Singleton</em> pode ser aplicado em várias outras lógicas de programação sempre que quiser garantir a existência de apenas uma instância de uma classe (se estiver usando ES6) ou de uma função construtura (se estiver usando ES5).</p>

  </article>

  <div class="share-page">
    <div class='social'>
      <b>
        Share this on &rarr;
      </b>
    </div>

    <div class='social'>
      <a href="https://facebook.com/sharer.php?u=https://saulosilva.github.io/javascript/sigleton-design-patterns-com-javascript" rel="nofollow" target="_blank" title="Share on Facebook" class='button-facebook waves-effect waves-light btn'>Facebook</a>
    </div>

    <div class='social'>
      <a href="https://plus.google.com/share?url=https://saulosilva.github.io/javascript/sigleton-design-patterns-com-javascript" rel="nofollow" target="_blank" title="Share on Google+" class='button-googleplus waves-effect waves-light btn'>Google+</a>
    </div>

    <div class='social'>
      <a href="https://twitter.com/intent/tweet?text=Singleton Design Patterns com Javascript&url=https://saulosilva.github.io/javascript/sigleton-design-patterns-com-javascript&via=SSILVASANTIAGO&related=SSILVASANTIAGO" rel="nofollow" target="_blank" title="Share on Twitter" class='button-twitter waves-effect waves-light btn'>Twitter</a>
    </div>

    <div class='social'>
      <a href="http://www.reddit.com/submit?url=https://saulosilva.github.io&title=Singleton Design Patterns com Javascript" class='button-reddit waves-effect waves-light btn' target="_blank">Reddit</a>
    </div>

    <div class='social'>
      <a href="http://www.linkedin.com/shareArticle?mini=true&url=https://saulosilva.github.io&title=Singleton Design Patterns com Javascript&summary=Singleton diz que você terá apenas uma instância de classe.&source=https://saulosilva.github.io" class='button-linkedin waves-effect waves-light btn' target="_blank">Linkedin</a>
    </div>
</div>
  
  <div class='comments'>
    <h2>Comentários:</h2>
    <span>
      <i class='mdi-editor-insert-comment'></i>
      Deixe sua dúvida, sugestão ou crítica, estou ancioso para saber tudo que você achou sobre este post:
    </span>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'saulosantiago';

        (function() {
            var dsq = document.createElement('script');

            dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>

</div>
    </main>

    <footer class='page-footer'>
  <div class="container">

    <div class="row">
      <div class="col s12 m6">
        <h5 class="white-text">Quem sou?</h5>
        <p class="grey-text text-lighten-4">
          Desenvolvedor Ruby e Javascript.</br>
          Trabalho há 6 anos com sistemas web.</br>
          Meu maior combustível é a cafeína.
        </p>
      </div>

      <div class="col s12 m6 center-align tecnologies">
        <img src="/assets/ruby-50x50-d33bb107e0f1317d3de0e4e6304713c2.png">
        <img src="/assets/node-50x50-8bea974eabd485d372132a1118e10474.png">
        <img src="/assets/html5-50x50-72d2704d488e9c4c503552cbf0b5bead.png">
        <img src="/assets/js-50x50-3226433e79f552c1ed89bb29bc295940.png">
        <img src="/assets/css3-50x50-acec2c028c8d5698ffc419f1a334cc95.png">
        <img src="/assets/backbonejs-50x50-51aa2ba5c1223ae086b06d00ff385d32.png">
        <img src="/assets/marionettejs-50x50-2155658edad81c6e95f56d6e29ffb02d.png">
        <img src="/assets/emberjs-50x50-453db9660b412918b79df70db015cc92.png">
        <img src="/assets/angular-50x50-57ed5d4f2ff76c9037c278b89980a47a.png">
        <img src="/assets/nginx-50x50-8311e34a24078c8f5e3637ac5ab1d5cc.png">
      </div>
    </div>
  </div>

  <div class="footer-copyright">
    <div class="container">
      &copy; 2015. All rights reserved for Saulo Santiago.
    </div>
  </div>
</footer>
  </body>

  <script src="/assets/application-d5c002228b1694b38b44d49a59b4b9a9.js"></script>
</html>